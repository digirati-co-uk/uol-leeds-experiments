@using Dashboard.Helpers
@using Utils
@model Fedora.Abstractions.Container

<div>
    @if(ViewBag.Result != null)
    {
        <div class="alert alert-success" role="alert">
            <p>@ViewBag.Result</p>
        </div>
    }

    @if (ViewBag.Problem != null)
    {
        <div class="alert alert-danger" role="alert">
            <p>@ViewBag.Problem</p>
        </div>
    }

    <partial name="_ArchivalGroupHeader" />

    @if (Model.Type == "RepositoryRoot")
    {
        <h1 class="display-4">🏠 @Model.GetDisplayName()</h1>
    } 
    else
    {
        <partial name="_ParentLink" />

        <h1 class="display-4">📁 @Model.GetDisplayName()</h1>
        <partial name="_CommonMetadata" model="Model" />
    }

    <partial name="_ContainerTable" model="Model" />

    @if (ViewBag.ArchivalGroupPath == null)
    {
        <form action="/create/@ViewBag.Path" method="post">
            <div class="mb-3">
                <label for="childContainerName" class="form-label">Add a child container:</label>
                <input type="text" class="form-control" id="childContainerName" name="name" placeholder="(📁 path-safe name of child container)">
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    }

    @if (ViewBag.ArchivalGroupPath == null && Model.Type != "RepositoryRoot")
    {
        <form id="newAgForm" action="/import/@ViewBag.Path/NEW-AG" method="get">
            <div class="mb-3">
                <label for="agName" class="form-label">Create an Archival Group:</label>
                <input type="text" class="form-control" id="agName" name="name" placeholder="(📦 path-safe name of archival group)">
            </div>
            <button type="submit" id="btnAgSubmit" class="btn btn-primary">Submit</button>
        </form>      
        
        <script type="text/javascript">

            const prefix = "/import/@(ViewBag.Path)/";
            const agForm = document.getElementById("newAgForm");
            agForm.addEventListener("submit", function (ev) {
                ev.preventDefault();
                const name = document.getElementById("agName").value;
                agForm.action = prefix + name;
                agForm.submit();
            });

        </script>
    }

</div>
